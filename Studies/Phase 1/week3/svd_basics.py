"""
Phase 1 - Week 3: SVD (íŠ¹ì´ê°’ ë¶„í•´) ê¸°ì´ˆ
==========================================
SVDì˜ ê¸°í•˜í•™ì  ì˜ë¯¸ì™€ SLAM ì‘ìš© ì‹¤ìŠµ

í•™ìŠµ ëª©í‘œ:
1. SVDì˜ ê¸°í•˜í•™ì  ì˜ë¯¸ ì´í•´ (íšŒì „-ìŠ¤ì¼€ì¼-íšŒì „)
2. íŠ¹ì´ê°’ì˜ ì˜ë¯¸ íŒŒì•…
3. SVDë¥¼ ì´ìš©í•œ ìµœì†ŒììŠ¹ í•´ êµ¬í•˜ê¸°
4. SLAMì—ì„œì˜ SVD í™œìš© ì´í•´
"""

import numpy as np
np.set_printoptions(precision=4, suppress=True)

print("=" * 60)
print("Phase 1 - Week 3: SVD (íŠ¹ì´ê°’ ë¶„í•´) ê¸°ì´ˆ")
print("=" * 60)

# ============================================================
# Part 0: SVDê°€ ì™œ í•„ìš”í•œê°€? - ê³ ìœ ê°’ ë¶„í•´ì™€ì˜ ì°¨ì´
# ============================================================
print("\n" + "=" * 60)
print("Part 0: SVDê°€ ì™œ í•„ìš”í•œê°€?")
print("=" * 60)

print("""
ğŸ’¡ ê³ ìœ ê°’ ë¶„í•´ (Eigenvalue Decomposition) ë³µìŠµ:
   - A = V Î› Vâ»Â¹ í˜•íƒœ
   - ì •ë°© í–‰ë ¬ (nÃ—n)ì—ë§Œ ì ìš© ê°€ëŠ¥!

ğŸ¤” ë¬¸ì œ: í˜„ì‹¤ì—ì„œëŠ” ì§ì‚¬ê° í–‰ë ¬ì´ ë” ë§ìŠµë‹ˆë‹¤.
   - ì´ë¯¸ì§€: 480Ã—640 (í–‰â‰ ì—´)
   - 8ê°œ ëŒ€ì‘ì ìœ¼ë¡œ Essential Matrix êµ¬í•  ë•Œ: 8Ã—9 í–‰ë ¬
   - ì„¼ì„œ ë°ì´í„°: ì¸¡ì • íšŸìˆ˜ Ã— ë³€ìˆ˜ ê°œìˆ˜ (ë³´í†µ ë‹¤ë¦„)

âœ¨ í•´ê²°ì±…: SVD (Singular Value Decomposition)
   - A = U Î£ Váµ€ í˜•íƒœ
   - ì–´ë–¤ í¬ê¸°ì˜ í–‰ë ¬ì´ë“  ë¶„í•´ ê°€ëŠ¥!
""")

# ì§ì‚¬ê° í–‰ë ¬ë„ ë¶„í•´ ê°€ëŠ¥í•¨ì„ ë³´ì—¬ì£¼ëŠ” ì˜ˆì œ
print("--- ì˜ˆì œ 1: m > n (í–‰ì´ ë” ë§ì€ ê²½ìš°) ---")
rect_A = np.array([
    [1, 2],
    [3, 4],
    [5, 6]
])  # 3Ã—2 í–‰ë ¬ (ì§ì‚¬ê°!)

print("3Ã—2 ì§ì‚¬ê° í–‰ë ¬ A:")
print(rect_A)

# full_matrices=True: Uì™€ Vë¥¼ ì™„ì „í•œ ì •ë°© ì§êµ í–‰ë ¬ë¡œ ë°˜í™˜
# full_matrices=False: ì¶•ì†Œëœ(reduced/economy) SVD ë°˜í™˜ (ë©”ëª¨ë¦¬ íš¨ìœ¨ì )
U_rect, S_rect, Vt_rect = np.linalg.svd(rect_A, full_matrices=True)
print(f"\nê³ ìœ ê°’ ë¶„í•´? â†’ ë¶ˆê°€ëŠ¥! (ì •ë°© í–‰ë ¬ì´ ì•„ë‹˜)")
print(f"SVD ë¶„í•´? â†’ ê°€ëŠ¥!")
print(f"  A í¬ê¸°: {rect_A.shape}")
print(f"  U í¬ê¸°: {U_rect.shape}")
print(f"  íŠ¹ì´ê°’: {S_rect}")
print(f"  Váµ€ í¬ê¸°: {Vt_rect.shape}")

# full_matrices ì˜µì…˜ ë¹„êµ
print("\n--- full_matrices ì˜µì…˜ ë¹„êµ ---")
print("""
ğŸ’¡ full_matrices íŒŒë¼ë¯¸í„°ë€?
   í–‰ë ¬ Aê°€ mÃ—n í¬ê¸°ì¼ ë•Œ (m=í–‰, n=ì—´, k=min(m,n)):
   
   full_matrices=True (ê¸°ë³¸ê°’):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  U: mÃ—m (ì™„ì „í•œ ì •ë°© ì§êµ í–‰ë ¬)                          â”‚
   â”‚  S: kê°œ íŠ¹ì´ê°’                                          â”‚
   â”‚  Váµ€: nÃ—n (ì™„ì „í•œ ì •ë°© ì§êµ í–‰ë ¬)                         â”‚
   â”‚  â†’ Null space ë¶„ì„, ì™„ì „í•œ ì§êµ ê¸°ì € í•„ìš”í•  ë•Œ ì‚¬ìš©       â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
   full_matrices=False (ì¶•ì†Œ SVD):
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  U: mÃ—k (í•„ìš”í•œ ì—´ë§Œ)                                   â”‚
   â”‚  S: kê°œ íŠ¹ì´ê°’                                          â”‚
   â”‚  Váµ€: kÃ—n (í•„ìš”í•œ í–‰ë§Œ)                                  â”‚
   â”‚  â†’ ë©”ëª¨ë¦¬/ê³„ì‚° íš¨ìœ¨, ëŒ€ë¶€ë¶„ì˜ ì‹¤ìš©ì  ì‚¬ìš©ì— ì í•©          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
""")

# ì‹¤ì œ ë¹„êµ ì˜ˆì œ
U_full, S_full, Vt_full = np.linalg.svd(rect_A, full_matrices=True)
U_reduced, S_reduced, Vt_reduced = np.linalg.svd(rect_A, full_matrices=False)

print(f"A í¬ê¸°: {rect_A.shape} (3Ã—2 í–‰ë ¬)")
print(f"\nfull_matrices=True:")
print(f"  U: {U_full.shape}, Váµ€: {Vt_full.shape}")
print(f"\nfull_matrices=False:")
print(f"  U: {U_reduced.shape}, Váµ€: {Vt_reduced.shape}")

print("""
ğŸ” SLAMì—ì„œì˜ ì„ íƒ ê¸°ì¤€:
   - Homography/Essential Matrix ë¶„í•´ â†’ True (Null space ë²¡í„° í•„ìš”)
   - ìµœì†ŒììŠ¹ í•´, ì´ë¯¸ì§€ ì••ì¶• â†’ False (íš¨ìœ¨ì„±)
""")

# Î£ í–‰ë ¬ êµ¬ì¡° ë³´ì—¬ì£¼ê¸°
print("\nÎ£ (ì‹œê·¸ë§ˆ) í–‰ë ¬ êµ¬ì¡°:")
Sigma_rect = np.zeros((3, 2))
Sigma_rect[:2, :2] = np.diag(S_rect)
print(Sigma_rect)
print("â†’ í–‰ì´ ë” ë§ì•„ì„œ 0ìœ¼ë¡œ ëœ í–‰ì´ ì¶”ê°€ë¨!")

# ë³µì› ê²€ì¦
A_reconstructed = U_rect @ Sigma_rect @ Vt_rect
print(f"\nU @ Î£ @ Váµ€ë¡œ ë³µì› ê°€ëŠ¥? {np.allclose(rect_A, A_reconstructed)}")

# ë°˜ëŒ€ ê²½ìš°: ì—´ì´ ë” ë§ì€ ê²½ìš°
print("\n--- ì˜ˆì œ 2: m < n (ì—´ì´ ë” ë§ì€ ê²½ìš°) ---")
rect_B = np.array([
    [1, 2, 3, 4],
    [5, 6, 7, 8]
])  # 2Ã—4 í–‰ë ¬

print("2Ã—4 ì§ì‚¬ê° í–‰ë ¬ B:")
print(rect_B)

U_B, S_B, Vt_B = np.linalg.svd(rect_B, full_matrices=True)
print(f"\n  B í¬ê¸°: {rect_B.shape}")
print(f"  U í¬ê¸°: {U_B.shape}")
print(f"  íŠ¹ì´ê°’: {S_B}")
print(f"  Váµ€ í¬ê¸°: {Vt_B.shape}")

# Î£ í–‰ë ¬ êµ¬ì¡° ë³´ì—¬ì£¼ê¸°
print("\nÎ£ (ì‹œê·¸ë§ˆ) í–‰ë ¬ êµ¬ì¡°:")
Sigma_B = np.zeros((2, 4))
Sigma_B[:2, :2] = np.diag(S_B)
print(Sigma_B)
print("â†’ ì—´ì´ ë” ë§ì•„ì„œ 0ìœ¼ë¡œ ëœ ì—´ì´ ì¶”ê°€ë¨!")

print("""
ğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸:
   A(mÃ—n) = U(mÃ—m) Ã— Î£(mÃ—n) Ã— Váµ€(nÃ—n)
   
   - Î£ í–‰ë ¬ í¬ê¸°ëŠ” ì›ë³¸ Aì™€ ë™ì¼!
   - ëŒ€ê°ì„ ì—ë§Œ íŠ¹ì´ê°’, ë‚˜ë¨¸ì§€ëŠ” 0
   - m > n: 0ìœ¼ë¡œ ëœ í–‰ ì¶”ê°€
   - m < n: 0ìœ¼ë¡œ ëœ ì—´ ì¶”ê°€
""")

# ê°„ë‹¨í•œ ëŒ€ê° í–‰ë ¬ ì˜ˆì œ - íšŒì „ ì—†ì´ ìŠ¤ì¼€ì¼ë§Œ
print("--- ì˜ˆì œ 3: ëŒ€ê° í–‰ë ¬ (íšŒì „ ì—†ìŒ) ---")
diagonal_A = np.array([
    [3, 0],
    [0, 2]
])
print("ëŒ€ê° í–‰ë ¬ A:")
print(diagonal_A)

U_diag, S_diag, Vt_diag = np.linalg.svd(diagonal_A)
print(f"\níŠ¹ì´ê°’: {S_diag}")
print(f"U (ë‹¨ìœ„í–‰ë ¬ = íšŒì „ ì—†ìŒ):\n{U_diag}")
print(f"Váµ€ (ë‹¨ìœ„í–‰ë ¬ = íšŒì „ ì—†ìŒ):\n{Vt_diag}")

print("""
ğŸ’¡ ëŒ€ê° í–‰ë ¬ì˜ SVD:
   - U, Váµ€ê°€ ë‹¨ìœ„í–‰ë ¬ â†’ íšŒì „ ì—†ìŒ!
   - íŠ¹ì´ê°’ = ëŒ€ê° ì›ì†Œ (ê° ì¶•ì˜ ìŠ¤ì¼€ì¼)
   - ê°€ì¥ ë‹¨ìˆœí•œ ê²½ìš°: ìŠ¤ì¼€ì¼ë§Œ ìˆëŠ” ë³€í™˜
""")

# ë¹„ëŒ€ê° í–‰ë ¬ ì˜ˆì œ - íšŒì „ + ìŠ¤ì¼€ì¼
print("--- ì˜ˆì œ 4: ë¹„ëŒ€ê° í–‰ë ¬ (íšŒì „ ìˆìŒ) ---")
rotation_scale_A = np.array([
    [2, 1],
    [1, 2]
])
print("ë¹„ëŒ€ê° í–‰ë ¬ A:")
print(rotation_scale_A)

U_rs, S_rs, Vt_rs = np.linalg.svd(rotation_scale_A)
print(f"\níŠ¹ì´ê°’: {S_rs}")
print(f"U (íšŒì „ í¬í•¨):\n{U_rs}")
print(f"Váµ€ (íšŒì „ í¬í•¨):\n{Vt_rs}")

print("""
ğŸ’¡ ë¹„ëŒ€ê° í–‰ë ¬ì˜ SVD:
   - U, Váµ€ê°€ ë‹¨ìœ„í–‰ë ¬ì´ ì•„ë‹˜ â†’ íšŒì „ì´ ìˆìŒ!
   - ì´ í–‰ë ¬ì˜ ë³€í™˜ = (Váµ€ íšŒì „) â†’ (ìŠ¤ì¼€ì¼) â†’ (U íšŒì „)
   - ë§ˆì¹˜ í¬í† ìƒµì—ì„œ: íšŒì „ â†’ ëŠ˜ë¦¬ê¸° â†’ ë˜ íšŒì „
""")

# ============================================================
# Part 1: SVD ê¸°ë³¸ - A = U Î£ Váµ€
# ============================================================
print("\n" + "=" * 60)
print("Part 1: SVD ê¸°ë³¸ ë¶„í•´")
print("=" * 60)

# ì˜ˆì œ í–‰ë ¬ (3x2)
A = np.array([
    [3, 2],
    [2, 3],
    [2, -2]
])

print("\nì›ë³¸ í–‰ë ¬ A (3Ã—2):")
print(A)

# SVD ë¶„í•´
U, S, Vt = np.linalg.svd(A, full_matrices=True)

print("\n--- SVD ë¶„í•´ ê²°ê³¼ ---")
print(f"\nU (ì™¼ìª½ íŠ¹ì´ë²¡í„°, {U.shape}):")
print(U)
print(f"\nS (íŠ¹ì´ê°’ë“¤): {S}")
print(f"\nVáµ€ (ì˜¤ë¥¸ìª½ íŠ¹ì´ë²¡í„°ì˜ ì „ì¹˜, {Vt.shape}):")
print(Vt)

# ë³µì› ê²€ì¦: A = U @ Î£ @ Váµ€
Sigma = np.zeros((3, 2))
Sigma[:2, :2] = np.diag(S)
A_reconstructed = U @ Sigma @ Vt

print("\n--- ë³µì› ê²€ì¦ ---")
print("Î£ (íŠ¹ì´ê°’ ëŒ€ê° í–‰ë ¬):")
print(Sigma)
print("\nU @ Î£ @ Váµ€ =")
print(A_reconstructed)
print(f"\nì›ë³¸ê³¼ ê°™ì€ê°€? {np.allclose(A, A_reconstructed)}")

print("\nğŸ’¡ í•µì‹¬ í¬ì¸íŠ¸:")
print("   - U: ì§êµ í–‰ë ¬ (Uáµ€ @ U = I)")
print("   - S: íŠ¹ì´ê°’ë“¤ (í•­ìƒ ì–‘ìˆ˜, ë‚´ë¦¼ì°¨ìˆœ)")
print("   - Váµ€: ì§êµ í–‰ë ¬ì˜ ì „ì¹˜")

# ============================================================
# Part 2: SVDì˜ ê¸°í•˜í•™ì  ì˜ë¯¸ - íšŒì „-ìŠ¤ì¼€ì¼-íšŒì „
# ============================================================
print("\n" + "=" * 60)
print("Part 2: SVDì˜ ê¸°í•˜í•™ì  ì˜ë¯¸")
print("=" * 60)

# 2x2 í–‰ë ¬ë¡œ ì‹œê°ì  ì´í•´
M = np.array([
    [2, 1],
    [1, 2]
])

U2, S2, Vt2 = np.linalg.svd(M)

print("\ní–‰ë ¬ M:")
print(M)
print(f"\níŠ¹ì´ê°’: {S2}")
print(f"\nU (ë‘ ë²ˆì§¸ íšŒì „):\n{U2}")
print(f"\nVáµ€ (ì²« ë²ˆì§¸ íšŒì „):\n{Vt2}")

# ë‹¨ìœ„ ì› ìœ„ì˜ ì ë“¤ ë³€í™˜
print("\n--- ë‹¨ìœ„ ì›ì˜ ë³€í™˜ ---")
theta = np.radians(45)
unit_vector = np.array([np.cos(theta), np.sin(theta)])

print(f"\nì…ë ¥ ë²¡í„° (ë‹¨ìœ„ ì› ìœ„): {unit_vector}")

step1 = Vt2 @ unit_vector
print(f"1ë‹¨ê³„ - Váµ€ (íšŒì „): {step1}")

step2 = np.diag(S2) @ step1
print(f"2ë‹¨ê³„ - Î£ (ìŠ¤ì¼€ì¼): {step2}")

step3 = U2 @ step2
print(f"3ë‹¨ê³„ - U (íšŒì „): {step3}")

direct = M @ unit_vector
print(f"\nì§ì ‘ ê³„ì‚° (M @ v): {direct}")
print(f"ê²°ê³¼ ì¼ì¹˜: {np.allclose(step3, direct)}")

print("\nğŸ’¡ ê¸°í•˜í•™ì  í•´ì„:")
print("   1. Váµ€: ì…ë ¥ ê³µê°„ì—ì„œ 'íŠ¹ì´ ë°©í–¥'ìœ¼ë¡œ ì¢Œí‘œì¶• íšŒì „")
print("   2. Î£: ê° íŠ¹ì´ ë°©í–¥ìœ¼ë¡œ ìŠ¤ì¼€ì¼ë§ (íƒ€ì›í™”)")
print("   3. U: ì¶œë ¥ ê³µê°„ì—ì„œ ìµœì¢… ë°©í–¥ìœ¼ë¡œ íšŒì „")

# ============================================================
# Part 3: íŠ¹ì´ê°’ì˜ ì˜ë¯¸
# ============================================================
print("\n" + "=" * 60)
print("Part 3: íŠ¹ì´ê°’ì˜ ì˜ë¯¸")
print("=" * 60)

# ë­í¬ê°€ ë‹¤ë¥¸ í–‰ë ¬ë“¤
full_rank = np.array([
    [1, 2],
    [3, 4]
])

rank_deficient = np.array([
    [1, 2],
    [2, 4]  # ì²« ë²ˆì§¸ í–‰ì˜ 2ë°° â†’ ë­í¬ 1
])

print("í–‰ë ¬ 1 (í’€ ë­í¬):")
print(full_rank)
_, s1, _ = np.linalg.svd(full_rank)
print(f"íŠ¹ì´ê°’: {s1}")
print(f"ë­í¬: {np.sum(s1 > 1e-10)}")

print("\ní–‰ë ¬ 2 (ë­í¬ ë¶€ì¡±):")
print(rank_deficient)
_, s2, _ = np.linalg.svd(rank_deficient)
print(f"íŠ¹ì´ê°’: {s2}")
print(f"ë­í¬: {np.sum(s2 > 1e-10)}")

print("\nğŸ’¡ íŠ¹ì´ê°’ê³¼ ë­í¬:")
print("   - 0ì´ ì•„ë‹Œ íŠ¹ì´ê°’ì˜ ê°œìˆ˜ = í–‰ë ¬ì˜ ë­í¬")
print("   - Ïƒ â‰ˆ 0ì´ë©´ ê·¸ ë°©í–¥ìœ¼ë¡œ ì •ë³´ê°€ ì—†ìŒ (ì°¨ì› ì¶•ì†Œ)")
print("   - ì¡°ê±´ìˆ˜(condition number) = Ïƒ_max / Ïƒ_min")

cond = s1[0] / s1[-1]
print(f"\ní–‰ë ¬ 1ì˜ ì¡°ê±´ìˆ˜: {cond:.4f}")

# ============================================================
# Part 4: ìµœì†ŒììŠ¹ í•´ (Least Squares with SVD)
# ============================================================
print("\n" + "=" * 60)
print("Part 4: ìµœì†ŒììŠ¹ í•´ (Ax â‰ˆ b)")
print("=" * 60)

# ê³¼ê²°ì • ì‹œìŠ¤í…œ (ë°©ì •ì‹ì´ ë¯¸ì§€ìˆ˜ë³´ë‹¤ ë§ìŒ)
A_ls = np.array([
    [1, 1],
    [1, 2],
    [1, 3],
    [1, 4]
])
b_ls = np.array([2.1, 2.9, 4.2, 4.8])

print("ì§ì„  í”¼íŒ… ë¬¸ì œ: y = a + b*x")
print("\nA (ì„¤ê³„ í–‰ë ¬):")
print(A_ls)
print(f"\nb (ê´€ì¸¡ê°’): {b_ls}")

# ë°©ë²• 1: NumPy ìµœì†ŒììŠ¹
x_lstsq, residuals, _, _ = np.linalg.lstsq(A_ls, b_ls, rcond=None)
print(f"\nìµœì†ŒììŠ¹ í•´: a = {x_lstsq[0]:.4f}, b = {x_lstsq[1]:.4f}")

# ë°©ë²• 2: SVDë¡œ ì§ì ‘ ê³„ì‚°
U_ls, S_ls, Vt_ls = np.linalg.svd(A_ls, full_matrices=False)

# ìœ ì‚¬ì—­í–‰ë ¬: Aâº = V Î£âº Uáµ€
S_inv = np.diag(1 / S_ls)
A_pinv_svd = Vt_ls.T @ S_inv @ U_ls.T
x_svd = A_pinv_svd @ b_ls

print(f"SVDë¡œ ê³„ì‚°í•œ í•´: a = {x_svd[0]:.4f}, b = {x_svd[1]:.4f}")
print(f"\në‘ ë°©ë²• ê²°ê³¼ ì¼ì¹˜: {np.allclose(x_lstsq, x_svd)}")

# ì˜ˆì¸¡ê°’ê³¼ ì”ì°¨
y_pred = A_ls @ x_lstsq
print(f"\nì˜ˆì¸¡ê°’: {y_pred}")
print(f"ì”ì°¨: {b_ls - y_pred}")
print(f"ì”ì°¨ ì œê³±í•©: {np.sum((b_ls - y_pred)**2):.6f}")

print("\nğŸ’¡ SVDì˜ ìµœì†ŒììŠ¹ í•´ ê³µì‹:")
print("   x = Aâºb = V Î£âº Uáµ€ b")
print("   ì—¬ê¸°ì„œ Î£âºëŠ” ê° Ïƒáµ¢ë¥¼ 1/Ïƒáµ¢ë¡œ ë°”ê¾¼ ê²ƒ")

# ============================================================
# Part 5: Null Space (ì˜ê³µê°„) ì°¾ê¸°
# ============================================================
print("\n" + "=" * 60)
print("Part 5: Null Space (Ax = 0ì˜ í•´)")
print("=" * 60)

# ë­í¬ ë¶€ì¡± í–‰ë ¬
A_null = np.array([
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
])

print("í–‰ë ¬ A (ë­í¬ ë¶€ì¡±):")
print(A_null)

U_n, S_n, Vt_n = np.linalg.svd(A_null)
print(f"\níŠ¹ì´ê°’: {S_n}")

# ë§ˆì§€ë§‰ íŠ¹ì´ê°’ì´ 0ì— ê°€ê¹Œì›€ â†’ í•´ë‹¹ V ì—´ì´ ì˜ê³µê°„
null_vector = Vt_n[-1, :]
print(f"\nNull space ë²¡í„° (Vì˜ ë§ˆì§€ë§‰ í–‰): {null_vector}")

# ê²€ì¦: A @ null_vector â‰ˆ 0
result = A_null @ null_vector
print(f"A @ null_vector = {result}")
print(f"ì˜ë²¡í„°ì— ê°€ê¹Œìš´ê°€? {np.allclose(result, 0)}")

print("\nğŸ’¡ SLAMì—ì„œì˜ í™œìš©:")
print("   - 'Ax = 0' í˜•íƒœì˜ ë™ì°¨ ì‹œìŠ¤í…œì—ì„œ í•´ ì°¾ê¸°")
print("   - Essential Matrix, Homography ê³„ì‚°ì— ì‚¬ìš©")

# ============================================================
# Part 6: SLAM ì‘ìš© - Essential Matrixì—ì„œ R, t ì¶”ì¶œ
# ============================================================
print("\n" + "=" * 60)
print("Part 6: SLAM ì‘ìš© - Essential Matrix ë¶„í•´")
print("=" * 60)

# Essential Matrix ì˜ˆì œ (ì‹¤ì œë¡œëŠ” íŠ¹ì´ê°’ì´ [Ïƒ, Ïƒ, 0] í˜•íƒœ)
# ì—¬ê¸°ì„œëŠ” ê°œë… ì´í•´ë¥¼ ìœ„í•œ ê°„ë‹¨í•œ ì˜ˆì œ
E_example = np.array([
    [0, -0.5, 0.2],
    [0.5, 0, -0.8],
    [-0.2, 0.8, 0]
])

print("Essential Matrix E (ì˜ˆì œ):")
print(E_example)

U_e, S_e, Vt_e = np.linalg.svd(E_example)

print(f"\níŠ¹ì´ê°’: {S_e}")
print("(ì´ìƒì ì¸ EëŠ” [Ïƒ, Ïƒ, 0] í˜•íƒœ)")

# W í–‰ë ¬ (íšŒì „ í–‰ë ¬ ì¶”ì¶œìš©)
W = np.array([
    [0, -1, 0],
    [1, 0, 0],
    [0, 0, 1]
])

print("\nW í–‰ë ¬ (90Â° Zì¶• íšŒì „):")
print(W)

# ë‘ ê°€ì§€ ê°€ëŠ¥í•œ R
R1 = U_e @ W @ Vt_e
R2 = U_e @ W.T @ Vt_e

# tëŠ” Uì˜ ì„¸ ë²ˆì§¸ ì—´
t = U_e[:, 2]

print("\n--- ë¶„í•´ ê²°ê³¼ ---")
print(f"R1:\n{R1}")
print(f"\ndet(R1) = {np.linalg.det(R1):.4f}")

print(f"\nt (í‰í–‰ì´ë™ ë°©í–¥): {t}")

print("\nğŸ’¡ Essential Matrix ë¶„í•´ í•µì‹¬:")
print("   - E = U diag(Ïƒ,Ïƒ,0) Váµ€ í˜•íƒœ")
print("   - Rì€ 4ê°€ì§€ í›„ë³´ (2ê°œ R Ã— 2ê°œ t ë¶€í˜¸)")
print("   - ì‹¤ì œ ì‚¬ìš© ì‹œ 'cheirality check'ë¡œ ì˜¬ë°”ë¥¸ í•´ ì„ íƒ")

# ============================================================
# Part 7: ì €ë­í¬ ê·¼ì‚¬ (ì´ë¯¸ì§€ ì••ì¶• ê°œë…)
# ============================================================
print("\n" + "=" * 60)
print("Part 7: ì €ë­í¬ ê·¼ì‚¬ (ì´ë¯¸ì§€ ì••ì¶• ê°œë…)")
print("=" * 60)

# 8x8 "ì´ë¯¸ì§€" ì˜ˆì œ
np.random.seed(42)
image = np.random.randint(0, 256, (8, 8)).astype(float)

print("ì›ë³¸ 'ì´ë¯¸ì§€' (8Ã—8):")
print(image.astype(int))

U_img, S_img, Vt_img = np.linalg.svd(image)
print(f"\níŠ¹ì´ê°’: {S_img.round(2)}")

# k=2ë¡œ ê·¼ì‚¬ (8ê°œ ì¤‘ 2ê°œë§Œ ì‚¬ìš©)
k = 2
U_k = U_img[:, :k]
S_k = np.diag(S_img[:k])
Vt_k = Vt_img[:k, :]

image_approx = U_k @ S_k @ Vt_k

print(f"\nì €ë­í¬ ê·¼ì‚¬ (k={k}):")
print(image_approx.astype(int))

# ì••ì¶•ë¥  ê³„ì‚°
original_params = 8 * 8  # 64ê°œ
compressed_params = k * (8 + 1 + 8)  # Uì˜ kì—´ + kê°œ íŠ¹ì´ê°’ + Vì˜ kí–‰

print(f"\nì›ë³¸ íŒŒë¼ë¯¸í„° ìˆ˜: {original_params}")
print(f"ì••ì¶• íŒŒë¼ë¯¸í„° ìˆ˜: {compressed_params}")
print(f"ì••ì¶•ë¥ : {compressed_params/original_params*100:.1f}%")

# ì˜¤ì°¨
error = np.linalg.norm(image - image_approx, 'fro')
print(f"í”„ë¡œë² ë‹ˆìš°ìŠ¤ ë…¸ë¦„ ì˜¤ì°¨: {error:.2f}")

print("\nğŸ’¡ ì €ë­í¬ ê·¼ì‚¬ì˜ ì˜ë¯¸:")
print("   - ìƒìœ„ kê°œ íŠ¹ì´ê°’ë§Œ ì‚¬ìš©í•˜ë©´ 'ì¤‘ìš”í•œ' ì •ë³´ ìœ ì§€")
print("   - ì´ë¯¸ì§€ ì••ì¶•, ë…¸ì´ì¦ˆ ì œê±°, ì°¨ì› ì¶•ì†Œì— í™œìš©")

# ============================================================
# ì •ë¦¬
# ============================================================
print("\n" + "=" * 60)
print("ğŸ“ Week 3 ì •ë¦¬")
print("=" * 60)

print("""
âœ… SVD ê¸°ë³¸
   - A = U Î£ Váµ€ (ëª¨ë“  í–‰ë ¬ì— ì ìš© ê°€ëŠ¥)
   - U, V: ì§êµ í–‰ë ¬
   - Î£: íŠ¹ì´ê°’ ëŒ€ê° í–‰ë ¬ (ì–‘ìˆ˜, ë‚´ë¦¼ì°¨ìˆœ)

âœ… ê¸°í•˜í•™ì  ì˜ë¯¸
   - ëª¨ë“  ì„ í˜• ë³€í™˜ = íšŒì „ â†’ ìŠ¤ì¼€ì¼ â†’ íšŒì „
   - íŠ¹ì´ê°’ = ê° ë°©í–¥ì˜ ìŠ¤ì¼€ì¼ë§ ì •ë„

âœ… í•µì‹¬ ì‘ìš©
   - ìµœì†ŒììŠ¹ í•´: x = V Î£âº Uáµ€ b
   - Null space: Ax = 0ì˜ í•´ = Ïƒ=0ì— ëŒ€ì‘í•˜ëŠ” Vì˜ ì—´
   - ì €ë­í¬ ê·¼ì‚¬: ìƒìœ„ kê°œ íŠ¹ì´ê°’ìœ¼ë¡œ ì••ì¶•

âœ… SLAMì—ì„œì˜ í™œìš©
   - Essential Matrix â†’ R, t ì¶”ì¶œ
   - Homography ë¶„í•´
   - PnP ë¬¸ì œ í•´ë²•
   - Triangulation
""")

# ============================================================
# Part 8: íŠ¹ì´ê°’ ì†ê³„ì‚° (Manual Singular Value Calculation)
# ============================================================
print("\n" + "=" * 60)
print("Part 8: íŠ¹ì´ê°’ì„ ì†ìœ¼ë¡œ ê³„ì‚°í•˜ëŠ” ë°©ë²•")
print("=" * 60)

print("""
ğŸ’¡ íŠ¹ì´ê°’ ê³„ì‚° ê³µì‹:
   
   âš ï¸  ì¤‘ìš”: mÃ—n ì§ì‚¬ê° í–‰ë ¬ AëŠ” ì§ì ‘ ê³ ìœ ê°’ì„ êµ¬í•  ìˆ˜ ì—†ìŒ!
       (ê³ ìœ ê°’ì€ ì •ë°© í–‰ë ¬ì—ë§Œ ì •ì˜ë¨)
   
   í•´ê²°ì±…: Aë¥¼ ì •ë°© í–‰ë ¬ë¡œ ë³€í™˜
   - A^T A: nÃ—n ì •ë°© í–‰ë ¬ (ì¼ë°˜ì ìœ¼ë¡œ ì‚¬ìš©)
   - A A^T: mÃ—m ì •ë°© í–‰ë ¬
   
   ê³„ì‚° ë‹¨ê³„:
   1. A^T Aë¥¼ ê³„ì‚° (nÃ—n ëŒ€ì¹­ ì •ë°© í–‰ë ¬)
   2. det(A^T A - Î»I) = 0ì„ í’€ì–´ ê³ ìœ ê°’ Î» êµ¬í•˜ê¸°
   3. íŠ¹ì´ê°’ Ïƒ = âˆšÎ»
""")

# ì˜ˆì œ í–‰ë ¬
A_manual = np.array([
    [3, 0],
    [4, 5]
])

print("ì˜ˆì œ í–‰ë ¬ A (2Ã—2):")
print(A_manual)
print(f"í˜•íƒœ: {A_manual.shape}")

print("""
ì´ ê²½ìš° AëŠ” ì´ë¯¸ ì •ë°© í–‰ë ¬ì´ì§€ë§Œ,
ì¼ë°˜ì ì¸ mÃ—n ì§ì‚¬ê° í–‰ë ¬ì— ì ìš©ë˜ëŠ” ë°©ë²•ìœ¼ë¡œ ê³„ì‚°í•©ë‹ˆë‹¤.
""")

# 1ë‹¨ê³„: A^T A ê³„ì‚°
print("\n--- 1ë‹¨ê³„: A^T A ê³„ì‚° ---")
A_transpose = A_manual.T
ATA = A_transpose @ A_manual

print("A^T:")
print(A_transpose)
print(f"í˜•íƒœ: {A_transpose.shape}")
print("\nA^T A:")
print(ATA)
print(f"í˜•íƒœ: {ATA.shape} â† ì •ë°© í–‰ë ¬ì´ë¯€ë¡œ ê³ ìœ ê°’ ê³„ì‚° ê°€ëŠ¥!")
print("""
ìˆ˜ì‹ìœ¼ë¡œ:
[[3, 4],  Ã— [[3, 0],  = [[25, 20],
 [0, 5]]     [4, 5]]     [20, 25]]
""")

# 2ë‹¨ê³„: ê³ ìœ ê°’ ê³„ì‚°
print("--- 2ë‹¨ê³„: ê³ ìœ ê°’(Î») ê³„ì‚° ---")
print("""
íŠ¹ì„±ë°©ì •ì‹: det(A^T A - Î»I) = 0

[[25-Î»,   20  ],
 [  20,  25-Î»]]

ì „ê°œí•˜ë©´:
(25-Î»)(25-Î») - 20Ã—20 = 0
(25-Î»)Â² - 400 = 0
Î»Â² - 50Î» + 225 = 0

ê·¼ì˜ ê³µì‹ ì‚¬ìš©:
Î» = (50 Â± âˆš(2500 - 900)) / 2
  = (50 Â± âˆš1600) / 2
  = (50 Â± 40) / 2

ë”°ë¼ì„œ:
Î»â‚ = 45
Î»â‚‚ = 5
""")

# NumPyë¡œ ê³ ìœ ê°’ ê³„ì‚°í•˜ì—¬ ê²€ì¦
eigenvalues, eigenvectors = np.linalg.eig(ATA)
print(f"NumPyë¡œ ê³„ì‚°í•œ ê³ ìœ ê°’: {eigenvalues}")

# 3ë‹¨ê³„: íŠ¹ì´ê°’ ê³„ì‚°
print("\n--- 3ë‹¨ê³„: íŠ¹ì´ê°’(Ïƒ) ê³„ì‚° ---")
print("""
íŠ¹ì´ê°’ì€ ê³ ìœ ê°’ì˜ ì œê³±ê·¼:
Ïƒâ‚ = âˆšÎ»â‚ = âˆš45 = 3âˆš5 â‰ˆ 6.708
Ïƒâ‚‚ = âˆšÎ»â‚‚ = âˆš5 â‰ˆ 2.236
""")

# ì†ìœ¼ë¡œ ê³„ì‚°í•œ íŠ¹ì´ê°’
manual_singular_values = np.sqrt(eigenvalues)
manual_singular_values.sort()
manual_singular_values = manual_singular_values[::-1]  # ë‚´ë¦¼ì°¨ìˆœ

print(f"ì†ê³„ì‚° íŠ¹ì´ê°’ (ì •ë ¬): {manual_singular_values}")

# NumPy SVDì™€ ë¹„êµ
U_check, S_check, Vt_check = np.linalg.svd(A_manual)
print(f"\nNumPy SVD íŠ¹ì´ê°’:    {S_check}")
print(f"ì°¨ì´: {np.abs(manual_singular_values - S_check)}")
print(f"ì¼ì¹˜ ì—¬ë¶€: {np.allclose(manual_singular_values, S_check)}")

# ìƒì„¸í•œ ê³„ì‚° ê³¼ì • ì‹œê°í™”
print("\n--- ìƒì„¸ ê³„ì‚° ê³¼ì • ---")
print("Î»â‚ = 45ì˜ ê²½ìš°:")
print(f"  âˆš45 = âˆš(9Ã—5) = 3âˆš5")
print(f"  âˆš5 â‰ˆ 2.236")
print(f"  3 Ã— 2.236 = 6.708")

print("\nÎ»â‚‚ = 5ì˜ ê²½ìš°:")
print(f"  âˆš5 â‰ˆ 2.236")

# ê¸°í•˜í•™ì  ì˜ë¯¸ ì„¤ëª…
print("\n--- ê¸°í•˜í•™ì  ì˜ë¯¸ ---")
print(f"""
íŠ¹ì´ê°’ [{manual_singular_values[0]:.3f}, {manual_singular_values[1]:.3f}]ëŠ”:
  - ì²« ë²ˆì§¸ ë°©í–¥ìœ¼ë¡œ {manual_singular_values[0]:.3f}ë°° ìŠ¤ì¼€ì¼
  - ë‘ ë²ˆì§¸ ë°©í–¥ìœ¼ë¡œ {manual_singular_values[1]:.3f}ë°° ìŠ¤ì¼€ì¼
  
ì¦‰, í–‰ë ¬ AëŠ” ì…ë ¥ì„ ì•½ 6.7ë°°ì™€ 2.2ë°°ë¡œ ëŠ˜ë¦¬ëŠ” ë³€í™˜!
""")

# 3x3 í–‰ë ¬ ì˜ˆì œ (ê°„ë‹¨í•œ ê²½ìš°)
print("\n--- 3Ã—3 í–‰ë ¬ ì˜ˆì œ (ëŒ€ê° í–‰ë ¬) ---")
A_3x3 = np.array([
    [4, 0, 0],
    [0, 3, 0],
    [0, 0, 2]
])

print("ëŒ€ê° í–‰ë ¬ A:")
print(A_3x3)

ATA_3x3 = A_3x3.T @ A_3x3
print("\nA^T A:")
print(ATA_3x3)

print("""
ëŒ€ê° í–‰ë ¬ì˜ ê²½ìš°:
  A^T A = diag([16, 9, 4])
  
ê³ ìœ ê°’:
  Î»â‚ = 16, Î»â‚‚ = 9, Î»â‚ƒ = 4
  
íŠ¹ì´ê°’:
  Ïƒâ‚ = âˆš16 = 4
  Ïƒâ‚‚ = âˆš9 = 3
  Ïƒâ‚ƒ = âˆš4 = 2
  
â†’ ëŒ€ê° í–‰ë ¬ì˜ íŠ¹ì´ê°’ = ëŒ€ê° ì›ì†Œì˜ ì ˆëŒ“ê°’!
""")

eigenvalues_3x3 = np.linalg.eigvals(ATA_3x3)
manual_sv_3x3 = np.sqrt(eigenvalues_3x3)
manual_sv_3x3.sort()
manual_sv_3x3 = manual_sv_3x3[::-1]

_, S_3x3, _ = np.linalg.svd(A_3x3)
print(f"ì†ê³„ì‚°: {manual_sv_3x3}")
print(f"NumPy:  {S_3x3}")
print(f"ì¼ì¹˜:   {np.allclose(manual_sv_3x3, S_3x3)}")

print("""
ğŸ’¡ í•µì‹¬ ì •ë¦¬:
   1. A^T Aì˜ ê³ ìœ ê°’ì„ êµ¬í•˜ë©´
   2. ê·¸ ì œê³±ê·¼ì´ Aì˜ íŠ¹ì´ê°’
   3. ì´ê²ƒì´ SVDì˜ ìˆ˜í•™ì  ê¸°ì´ˆ!
   
   SLAMì—ì„œ: ì‘ì€ íŠ¹ì´ê°’(â‰ˆ0)ì€ ë…¸ì´ì¦ˆ/ë¶ˆí•„ìš” ì •ë³´
            â†’ ì œê±°í•´ë„ ë³¸ì§ˆì  ì •ë³´ ìœ ì§€!
""")

# ============================================================
# ìµœì¢… ì •ë¦¬
# ============================================================
print("\n" + "=" * 60)
print("ğŸ¯ ë‹¤ìŒ ë‹¨ê³„")
print("=" * 60)

print("   - svd_quiz.pyë¡œ í€´ì¦ˆ í’€ê¸°")
print("   - Week 4: íšŒì „ í‘œí˜„ (íšŒì „ í–‰ë ¬, ì˜¤ì¼ëŸ¬ ê°, ì¿¼í„°ë‹ˆì–¸)")
